<!DOCTYPE html>
<html lang="en" class="bg-black text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>VaultLeakX | Cronos Intelligence</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: #10b981; }
    .event:hover { background-color: rgba(255, 255, 255, 0.05); transform: scale(1.01); }
    .glow { text-shadow: 0 0 4px #10b981; }
    .badge { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-top: 4px; display: inline-block; word-wrap: break-word; }
    .badge.deploy { background: #facc15; color: #000; }
    .badge.whale { background: #10b981; }
    .badge.mid { background: #f472b6; }
    .badge.small { background: #64748b; }
    .badge.gas { background: #f87171; }
    .badge.dex { background: #60a5fa; }
    .badge.token { background: #c084fc; }
    .badge.wallet { background: #f97316; }
    .badge.buy { background: #22c55e; }
    .badge.sell { background: #ef4444; }
  </style>
</head>
<body class="font-mono overflow-hidden">
  <div class="flex justify-between items-center px-6 py-4 bg-[#0f172a] border-b border-lime-400">
    <h1 class="text-xl glow font-bold text-lime-400 tracking-widest">VAULTLEAKX</h1>
    <div class="flex flex-wrap justify-end gap-4 text-xs">
      <div><span class="text-gray-400">CHAIN:</span> <span class="text-green-400">CRONOS</span></div>
      <div><span class="text-gray-400">STATUS:</span> <span class="animate-pulse text-lime-500">LIVE</span></div>
      <div><span class="text-gray-400">TXs:</span> <span id="txCount" class="text-white">0</span></div>
    </div>
  </div>

  <div class="flex h-[calc(100vh-64px)]">
    <aside class="w-60 bg-[#111827] p-3 space-y-3 border-r border-gray-800 text-sm">
      <h2 class="text-lime-300 font-semibold">Filters</h2>
      <label class="flex items-center space-x-2"><input type="checkbox" id="deploys" checked> <span>Deploys</span></label>
      <label class="flex items-center space-x-2"><input type="checkbox" id="whales" checked> <span>Whales</span></label>
      <label class="flex items-center space-x-2"><input type="checkbox" id="mid" checked> <span>Mid</span></label>
      <label class="flex items-center space-x-2"><input type="checkbox" id="small" checked> <span>Small</span></label>
      <label class="flex items-center space-x-2"><input type="checkbox" id="gas" checked> <span>Gas Bombs</span></label>
      <label class="flex items-center space-x-2"><input type="checkbox" id="dex" checked> <span>DEX TX</span></label>
      <div class="text-xs text-gray-500 pt-4">v3.2 ‚Äì Now with token preview, wallet labels & DEX logic</div>
    </aside>

    <main class="flex-1 bg-[#0b0f14] overflow-y-scroll p-3 space-y-3 text-sm" id="feed"></main>
  </div>

  <script>
    const provider = new ethers.providers.JsonRpcProvider('https://evm.cronos.org');
    const knownRouters = {
      '0x145677fc4d9b8f19b5d56d1820c48e0443049a30': 'MMF',
      '0x5ae401dcf3f8b7786d0562ea84b6f572a3b5e5d9': 'VVS',
      '0x3fb2f35b4b947b975f2b3e6a01989b1a98ae88af': 'Crona'
    };
    const smartWallets = {
      '0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef': 'Y2K Admin',
      '0xabcabcabcabcabcabcabcabcabcabcabcabcabca': 'Vault Syndicate'
    };
    let scanned = 0;
    const feed = document.getElementById('feed');
    const txCounter = document.getElementById('txCount');

    function getTag(address) {
      const addr = address.toLowerCase();
      return smartWallets[addr] ? `<span class="badge wallet">${smartWallets[addr]}</span>` : '';
    }

    function renderEvent(type, tx, info = {}) {
      scanned++;
      txCounter.textContent = scanned;
      const val = parseFloat(ethers.utils.formatEther(tx.value || 0));
      const valueFormatted = val.toLocaleString(undefined, { minimumFractionDigits: 2 });
      const gasFormatted = tx.gasPrice ? parseFloat(ethers.utils.formatUnits(tx.gasPrice, 'gwei')).toLocaleString(undefined, { minimumFractionDigits: 2 }) : 'N/A';

      const tags = {
        'üöÄ Contract Deployed': '<span class="badge deploy">Contract</span>',
        'ü¶à Whale Transfer': '<span class="badge whale">Whale</span>',
        'üêü Mid Transfer': '<span class="badge mid">Mid</span>',
        'ü™ô Small Transfer': '<span class="badge small">Small</span>',
        'üî• Gas Bomb Detected': `<span class="badge gas">Gas ${gasFormatted} Gwei</span>`,
        'üí± DEX Router Interaction': `<span class="badge dex">DEX TX</span> ${info.router || ''}`
      };

      const tokenTag = info.token ? `<span class="badge token">${info.token}</span>` : '';
      const actionTag = info.action ? `<span class="badge ${info.action === 'Buy' ? 'buy' : 'sell'}">${info.action}</span>` : '';
      const walletTag = getTag(tx.from);

      const card = document.createElement('div');
      card.className = 'event p-3 rounded-lg border border-lime-500 bg-black/20 transition-all duration-100 break-words';
      card.innerHTML = `
        <div class="text-xs text-gray-400">${new Date().toLocaleTimeString()}</div>
        <div class="font-semibold flex items-center gap-2">${type}</div>
        <div class="text-xs mt-1">From: ${tx.from} ${walletTag}</div>
        <div class="text-xs">To: ${tx.to || '[Contract Creation]'}</div>
        <div class="text-xs">Value: ${valueFormatted} CRO</div>
        <div class="text-xs">Gas: ${gasFormatted} Gwei</div>
        <div class="text-xs mt-1">Tx: <a href="https://cronoscan.com/tx/${tx.hash}" target="_blank" class="underline text-lime-300">${tx.hash.slice(0, 12)}...</a></div>
        <div class="mt-2">${tags[type] || ''} ${tokenTag} ${actionTag} ${info.tag ? `<span class="badge">${info.tag}</span>` : ''}</div>
      `;
      feed.prepend(card);
    }

    async function scanBlock() {
      const block = await provider.getBlockWithTransactions('latest');
      const filters = {
        deploys: document.getElementById('deploys').checked,
        whales: document.getElementById('whales').checked,
        mid: document.getElementById('mid').checked,
        small: document.getElementById('small').checked,
        gas: document.getElementById('gas').checked,
        dex: document.getElementById('dex').checked
      };

      for (const tx of block.transactions) {
        const val = parseFloat(ethers.utils.formatEther(tx.value || 0));
        const gas = tx.gasPrice ? parseFloat(ethers.utils.formatUnits(tx.gasPrice, 'gwei')) : 0;
        const to = tx.to?.toLowerCase();
        const info = {};

        if (knownRouters[to]) {
          info.token = 'Y2K/USDC'; // Placeholder for DEX Screener
          info.router = `<span class="badge">${knownRouters[to]}</span>`;
          info.action = tx.from.toLowerCase().includes('dead') ? 'Sell' : 'Buy'; // crude action tag example
        }

        if (tx.to === null && filters.deploys) {
          renderEvent('üöÄ Contract Deployed', tx);
        } else if (val > 1000 && filters.whales) {
          renderEvent('ü¶à Whale Transfer', tx, { ...info, tag: `${val.toLocaleString()} CRO` });
        } else if (val > 100 && val <= 1000 && filters.mid) {
          renderEvent('üêü Mid Transfer', tx, { ...info, tag: `${val.toLocaleString()} CRO` });
        } else if (val > 0 && val <= 100 && filters.small) {
          renderEvent('ü™ô Small Transfer', tx, { ...info, tag: `${val.toLocaleString()} CRO` });
        } else if (gas > 100 && filters.gas) {
          renderEvent('üî• Gas Bomb Detected', tx, { ...info });
        } else if (knownRouters[to] && filters.dex) {
          renderEvent('üí± DEX Router Interaction', tx, { ...info, tag: 'Router TX' });
        }
      }
    }

    provider.on('block', scanBlock);
  </script>
</body>
</html>
